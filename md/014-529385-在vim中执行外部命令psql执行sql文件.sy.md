---
show: step
version: 1.0
enable_checker: true
---

# åœ¨vimä¸­æ‰§è¡Œå¤–éƒ¨å‘½ä»¤psql

## å›å¿†

- ä¸Šæ¬¡æƒ³è¦è§£å†³
	- åœ¨shellå’Œpsqlä¸­æ¥å›åå¤åˆ‡æ¢çš„é—®é¢˜
- å…¨éƒ½åœ¨psqlä¸­æ‰§è¡Œ
  - \e è¿›è¡Œç¼–è¾‘
  - \i è¿›è¡Œè¿è¡Œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658391401106)

- è¿™æ ·å°±å¯ä»¥ä¸ç”¨
	- å…ˆ\qé€€å›åˆ°shell
	- å†è¿›vimäº†ç¼–è¾‘sqläº†
- è¿˜æœ‰æ›´å¥½ç”¨çš„å·¥ä½œæµä¹ˆï¼Ÿ

### æŸ¥è¯¢å¤–éƒ¨å‘½ä»¤

- å°è¯•è§‚å¯Ÿä¸€ä¸‹psqlå‘½ä»¤çš„å‚æ•°

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658391837636)

- å¥½åƒå¯ä»¥æ‰§è¡Œæ–‡ä»¶ä¸­çš„sqlè¯­å¥

### å°è¯•è¿è¡Œ

- sudo -u postgres psql -f /tmp/test.sql
	- sudo -u postgres ä½¿ç”¨postgresèº«ä»½
	- psql è¿è¡Œpsqlå®¢æˆ·ç«¯
	- -f /tmp/test.sql æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221216-1671193501137)

- æ‰§è¡ŒæˆåŠŸï¼

### ç¼–è¾‘

```
\c postgres

DROP DATABASE IF EXISTS
    oeasydb;

CREATE DATABASE
    oeasydb;

\c oeasydb

CREATE TABLE login(
    username VARCHAR(20),
    password VARCHAR(20)
)
;

INSERT INTO
    login(username, password)
VALUES
    ('oeasy', '123'),
    ('o2z', '456'),
    ('o3z', '789')
;

```
- åœ¨shellä¸­ç”¨vimæ‰“å¼€/tmp/test.sql

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230608-1686232098549)

- å°è¯•:wä¿å­˜

### è¿è¡Œç»“æœ

- ä¿å­˜å¤±è´¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230608-1686232125947)

- åŸå› å°±æ˜¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230608-1686232159778)

- å½“å‰shellçš„é»˜è®¤ç”¨æˆ·åshiyanlou
	- å·²ç»å¤±å»äº†å¯¹äº/tmp/test.sqlçš„å†™æƒé™
- é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿï¼Ÿ

### å·¥ä½œæµè°ƒä¼˜

- /tmp/test.sqlçš„å†™æƒé™ä»shiyanlouæ‰‹é‡Œ
	- ç»™åˆ°äº†postgresæ‰‹é‡Œ
		- æ‰€ä»¥ç”¨postgreså°±å¯ä»¥å†™/tmp/test.sqläº†
- é¦–å…ˆä»¥postgresèº«ä»½è¿›å…¥psql

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221216-1671193806008)

- \e /tmp/test.sql
	- è¿›è¡Œç¼–è¾‘

### ä¿å­˜å¹¶æ‰§è¡Œsqlæ–‡ä»¶

- ç”±äºæˆ‘ä»¬æ˜¯ä»¥postgresçš„èº«ä»½æ‰§è¡Œçš„psql
	- æ‰€ä»¥å¯ä»¥ä¿å­˜ 
		- ç„¶åç›´æ¥è¿è¡Œpsql -f /tmp/test.sql

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221216-1671193919958)

- ç¡®å®æ˜¯å¯ä»¥æ‰§è¡Œsqlè¯­å¥çš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221216-1671193945019)

- ä¸ºä»€ä¹ˆä¸ç”¨åŠ sudo -u postgreså‘¢ï¼Ÿ

### ç”¨æˆ·

- æˆ‘ä»¬è¿è¡Œpsqlå‘½ä»¤çš„æ—¶å€™
	- æ˜¯ä»¥postgresè¿™ä¸ªç”¨æˆ·æ¥è¿è¡Œçš„
	- æ‰€ä»¥åœ¨psqlä¸­æˆ‘ä»¬è¿›å…¥vimçš„æ—¶å€™
	- è¿˜æ˜¯ä»¥postgresç”¨æˆ·æ¥è¿è¡Œçš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230608-1686232411913)

- åœ¨vimä¸­è¿è¡Œå¤–éƒ¨å‘½ä»¤çš„æ—¶å€™
	- ç”¨æˆ·è¿˜æ˜¯postgres
	- postgresåˆšå¥½æ˜¯èƒ½æ‰§è¡Œpsqlå‘½ä»¤çš„ç”¨æˆ·
	- æ‰€ä»¥å°±å¯ä»¥ç›´æ¥æ‰§è¡Œäº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658392626546)

- é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸ªå‰æ

### å¦ä¸€ä¸ªå‰æ

- è¿˜æœ‰ä¸ªå‰ææ˜¯postgresç”¨æˆ·
	- æœ‰/tmp/test.sqlçš„å†™æƒé™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390504342)

- ç°åœ¨æˆ‘ä»¬å¯ä»¥ä¸å‡ºpsqlä¸­çš„vim
	- å°±åœ¨vimä¸­ç¼–è¾‘å¹¶è¿è¡Œsqlæ–‡ä»¶
	- ä¹Ÿå¯ä»¥åœ¨vimä¸­ æ‰§è¡Œsqlæ–‡ä»¶ä¸­çš„å†…å®¹
- æˆ‘è§‰å¾—è¿™å°±æ˜¯æœ€å¥½çš„å·¥ä½œæµäº†
	- å¦‚æœæ‚¨è¿˜æœ‰æ›´å¥½çš„
	- è¯·é€šè¿‡çº é”™å‘Šè¯‰æˆ‘
- æˆ‘ä»¬ä¸€èµ·è®©æ•™ç¨‹è¿›æ­¥

### æ€»ç»“

- è¿™æ¬¡æˆ‘ä»¬ä¼˜åŒ–äº†å·¥ä½œæµ

1. å…ˆè¿›å…¥psql
2. \e /tmp/test.sql ç¼–è¾‘sqlæ–‡ä»¶
3. :w|!psql -f % ä¿å­˜å¹¶è¿è¡Œsqlæ–‡ä»¶
4. :q é€€å›åˆ°psqlæ‰§è¡Œå…¶ä»–çš„äº¤äº’å‘½ä»¤

- è¿™æ ·å°±å¯ä»¥æ‰¹å¤„ç†sqlè¯­å¥äº†
	- ä¹Ÿå°±å¯ä»¥åˆå§‹åŒ–æ•°æ®åº“äº†

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658393108067)

- ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æƒ³æ¢å¤åˆ°å‡ºå‚çŠ¶æ€
	- è€Œæ˜¯å¸Œæœ›æŠŠå½“å‰çŠ¶æ€å¤‡ä»½(backup)
	- æ–¹ä¾¿ä»¥åå¯ä»¥è¿›è¡Œè¿˜åŸ(restore)
- åº”è¯¥æ€ä¹ˆåšå‘¢ï¼ŸğŸ¤”
- æˆ‘ä»¬ä¸‹æ¬¡å†è¯´ğŸ‘‹ğŸ»
