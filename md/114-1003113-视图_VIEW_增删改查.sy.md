---
show: step
version: 1.0
enable_checker: true
---

#    ä¸»é”®_å¤–é”®_ä¸»è¡¨_ä»è¡¨_foreign_key_master_table       
 
##  å›å¿†

- ä¸Šæ¬¡äº†è§£äº†2NFçš„å¦ä¸€ä¸ªå¥½å¤„
	- åœ¨ä»è¡¨ä¸­åˆ é™¤ç›¸å…³è®°å½•æ—¶
	- ä¸å½±å“ä¸»è¡¨ä¸­çš„æ•°æ®
	- åº—é“ºçš„åå­—ä¾ç„¶å­˜åœ¨

- æ‹†è¡¨å ä¸æ²¡æ‹†è¡¨ä¹‹å‰ç›¸æ¯”
	- æœ‰è¯¸å¤šä¸åŒ
- èƒ½å¦æœ‰ä»€ä¹ˆæ–¹å¼ 
	- ä½¿å¾—æ‹†è¡¨åè¿˜åƒæ²¡æ‹†ä¸€æ ·
		- çœ‹èµ·æ¥ è¿˜æ˜¯ä¸€ä¸ªè¡¨å‘¢ï¼Ÿï¼ŸğŸ¤”

### æ„å»ºç¯å¢ƒ


```
DROP DATABASE 
	chinese_food_city;

CREATE DATABASE
	chinese_food_city;
	
\c chinese_food_city

CREATE TABLE public.bill (
    ic_id character varying(10),
    dk_id character varying(10),
    deal_time timestamp without time zone,
    price numeric
);

CREATE TABLE public.stall (
    dk_id character varying(10),
    shop character varying(20),
    shop_owner character varying(20)
);

COPY public.bill (ic_id, dk_id, deal_time, price) FROM stdin;
ic2034123	dk1000234	2023-09-30 11:30:01	15
ic2052342	dk1001584	2023-09-30 11:33:03	30
ic2034123	dk1001584	2023-09-30 11:34:04	3
ic2033233	dk1003324	2023-09-30 11:36:23	20
ic2035678	dk1000436	2023-09-30 11:36:44	20
ic2034434	dk1001584	2023-09-30 11:37:51	25
ic1034139	dk1003324	2023-09-30 11:38:23	20
\.

COPY public.stall (dk_id, shop, shop_owner) FROM stdin;
dk1000436	é¥­æ˜¯é’¢	èƒ¡å°å–µ
dk1000234	å…°å·æ‹‰é¢	åˆ˜è€æ ¹
dk1003324	ç…é¥¼è™å¤´å†›	èƒ¡å°å–µ
dk1001584	è€å®¶è‚‰é¥¼	åˆ˜è€æ ¹
\.

```

### åˆ›å»ºè§†å›¾

- https://www.postgresql.org/docs/current/sql-createview.html

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231005-1696497308727)

- å¯ä»¥åˆ›å»ºä¸€ç§æ–°çš„ä¸œè¥¿ 
	- å«åšè§†å›¾
	- VIEW

### åˆ›å»ºè§†å›¾

```
CREATE VIEW vista AS SELECT 'Hello World';
SELECT * FROM vista;
```

- æ‰§è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231005-1696497443026)

- åˆ—åä¸æ˜ç¡®

### åˆ é™¤å¹¶æ–°å»º

```
DROP VIEW vista;
CREATE VIEW vista AS SELECT text 'Hello World' AS hello;
SELECT * FROM vista;
```

- æ‰§è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231005-1696497606411)

### æŸ¥çœ‹æ‰€æœ‰è§†å›¾

- \\d å¯ä»¥æŸ¥çœ‹è§†å›¾

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231005-1696497846342)

- æƒ³è¦ä½¿ç”¨å®é™…æŸ¥è¯¢ä½œä¸ºè§†å›¾

### åˆ›å»º stall è§†å›¾

```
\c chinese_food_city
CREATE OR REPLACE VIEW full_bill AS
	SELECT DISTINCT
		bill.*,
		stall.shop,
		stall.shop_owner
	FROM
		bill
	NATURAL JOIN
		stall
;

\d

\d full_bill
```

- æŸ¥è¯¢æ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231005-1696498019427)

### æŸ¥çœ‹æŸ¥è¯¢

```
\c chinese_food_city
SELECT * FROM full_bill;
```

- æ‰§è¡Œæ•ˆæœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20231005-1696498121503)

- è¿™æ ·å°±æŠŠä¸¤ä¸ªè¡¨å˜æˆä¸€ä¸ªè¡¨äº†ï¼
- ç›´æ¥æŸ¥è¯¢è¿™ä¸€ä¸ªè¡¨å°±å¯ä»¥

##  æ€»ç»“
- è¿™æ¬¡äº†è§£äº† è§†å›¾VIEW
- è§†å›¾View
	- æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æŸ¥è¯¢è¯­å¥
		- è§†å›¾æœ¬èº«ä¸åŒ…å«æ•°æ®
		- ä¹Ÿè¢«ç§°ä¸ºè™šæ‹Ÿè¡¨
	- åœ¨åˆ›å»ºè§†å›¾æ—¶ç»™å®ƒæŒ‡å®šäº†ä¸€ä¸ªåç§°
		- ç„¶åå¯ä»¥åƒè¡¨ä¸€æ ·å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢
- ä¼˜åŠ¿
	1. ä¸ä¿å­˜æ•°æ® èŠ‚çœç©ºé—´
	2. å‡å°‘é¢‘ç¹è°ƒç”¨ sql çš„é‡å¤ä¹¦å†™
	3. å¯æ§åˆ¶æ•°æ®è®¿é—® éšè—ä¸æƒ³å¯¹å¤–å±•ç¤ºçš„æ•°æ®
- åŠ£åŠ¿
	1. å¯èƒ½å¢åŠ æ•°æ®åº“å‹åŠ›
	2. ä¸¥é‡æ—¶ä¼šå¦¨ç¢æ•´ä¸ªæ•°æ®åº“çš„è¿è¡Œ
- è§†å›¾è¿˜æœ‰ä»€ä¹ˆå¯ä»¥ç©çš„å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ŸğŸ‘‹

