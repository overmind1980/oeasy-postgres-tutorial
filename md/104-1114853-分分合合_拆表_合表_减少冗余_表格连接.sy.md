---
show: step
version: 1.0
enable_checker: true
---

#  åˆ†åˆ†åˆåˆ_æ‹†è¡¨_åˆè¡¨_å‡å°‘å†—ä½™_è¡¨æ ¼è¿æ¥     
 
##  å›å¿†

- ä¸Šæ¬¡åœ¨ç¬›å¡å°”ç§¯çš„åŸºç¡€ä¸Š
	- å¢åŠ äº†ä¸€ä¸ªç­›é€‰
	- æ ¹æ®å®ç‰©å°†
		- æ­¦å°†è¡¨
		- å®ç‰©è¡¨
		- è¿æ¥äº†èµ·æ¥
- è¿™ç§è¿æ¥æ–¹å¼
	- æœ‰åå­—å—ï¼Ÿ
	- è¿˜æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯å—ï¼ŸğŸ¤”

### å›åˆ°æœ€åˆ

- é¤å…æ•°æ®

```
ic_id,dk_id,deal_time,price,shop,shop_owner
ic2034123,dk1000234,2023-09-30 11:30:01,15,å…°å·æ‹‰é¢,åˆ˜è€æ ¹
ic2052342,dk1001584,2023-09-30 11:33:03,30,è€å®¶è‚‰é¥¼,åˆ˜è€æ ¹
ic2034123,dk1001584,2023-09-30 11:34:04,3,è€å®¶è‚‰é¥¼,åˆ˜è€æ ¹
ic2033233,dk1003324,2023-09-30 11:36:23,20,ç…é¥¼è™å¤´å†›,èƒ¡å°å–µ
ic2035678,dk1000436,2023-09-30 11:36:44,20,é¥­æ˜¯é’¢,èƒ¡å°å–µ
ic2034434,dk1001584,2023-09-30 11:37:51,25,è€å®¶è‚‰é¥¼,åˆ˜è€æ ¹
ic1034139,dk1003324,2023-09-30 11:38:23,20,ç…é¥¼è™å¤´å†›,èƒ¡å°å–µ
```

- å»ºè¡¨å¯¼å…¥

```
CREATE DATABASE 
	chinese_food_city
;

\c chinese_food_city

CREATE TABLE bill(
	ic_id VARCHAR(10),
	dk_id VARCHAR(10),
	deal_time timestamp without time zone,
	price NUMERIC,
	shop VARCHAR(20),
	shop_owner VARCHAR(20)
)
;

COPY 
	bill(ic_id,dk_id,deal_time,price,shop,shop_owner)
FROM
	'/home/shiyanlou/bill.csv'
WITH
	CSV HEADER
;
```

### æ‹†è¡¨å¡«æ•°æ®

```
\c chinese_food_city

CREATE TABLE stall(
	dk_id VARCHAR(10),
	shop VARCHAR(20),
	shop_owner VARCHAR(20)
)
;

INSERT INTO
	stall(dk_id,shop,shop_owner)
SELECT DISTINCT
	dk_id,
	shop,
	shop_owner
FROM
	bill
;

ALTER TABLE
	bill
DROP COLUMN 
	shop
;

ALTER TABLE
	bill
DROP COLUMN 
	shop_owner
;
```

- å®Œæˆè½¬åŒ–

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230906-1694008210314)

### æœ€ç»ˆç»“æœ

- æœ€ç»ˆç»“æœå¦å­˜ä¸ºsqlæ–‡ä»¶

```
sudo -u postgres pg_dump chinese_food_city > chinese_food_city.sql
```

- å¯¼å‡ºç»“æœ
	- éœ€è¦åœ¨å¤´éƒ¨ åŠ ä¸Šå»ºåº“å’Œè¿›åº“çš„è¯­å¥


```
DROP DATABASE 
	chinese_food_city;

CREATE DATABASE
	chinese_food_city;
	
\c chinese_food_city

--
-- PostgreSQL database dump
--

-- Dumped from database version 12.16 (Ubuntu 12.16-0ubuntu0.20.04.1)
-- Dumped by pg_dump version 12.16 (Ubuntu 12.16-0ubuntu0.20.04.1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: bill; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.bill (
    ic_id character varying(10),
    dk_id character varying(10),
    deal_time timestamp without time zone,
    price numeric
);


ALTER TABLE public.bill OWNER TO postgres;

--
-- Name: stall; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.stall (
    dk_id character varying(10),
    shop character varying(20),
    shop_owner character varying(20)
);


ALTER TABLE public.stall OWNER TO postgres;

--
-- Data for Name: bill; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.bill (ic_id, dk_id, deal_time, price) FROM stdin;
ic2034123	dk1000234	2023-09-30 11:30:01	15
ic2052342	dk1001584	2023-09-30 11:33:03	30
ic2034123	dk1001584	2023-09-30 11:34:04	3
ic2033233	dk1003324	2023-09-30 11:36:23	20
ic2035678	dk1000436	2023-09-30 11:36:44	20
ic2034434	dk1001584	2023-09-30 11:37:51	25
ic1034139	dk1003324	2023-09-30 11:38:23	20
\.


--
-- Data for Name: stall; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.stall (dk_id, shop, shop_owner) FROM stdin;
dk1000436	é¥­æ˜¯é’¢	èƒ¡å°å–µ
dk1000234	å…°å·æ‹‰é¢	åˆ˜è€æ ¹
dk1003324	ç…é¥¼è™å¤´å†›	èƒ¡å°å–µ
dk1001584	è€å®¶è‚‰é¥¼	åˆ˜è€æ ¹
\.


--
-- PostgreSQL database dump complete
--
```

### åˆäºŒä¸ºä¸€

- å°†è¿™ä¸¤ä¸ªè¡¨æ ¼è¿æ¥åˆ°ä¸€èµ·

```
\c chinese_food_city

SELECT 
    * 
FROM
    stall,
    bill
WHERE
    stall.dk_id = bill.dk_id
;
```

- æœç´¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230916-1694863132552)

- å¯ä»¥åšåˆ° å®Œå…¨å’ŒåŸæ¥ä¸€ä¸ªè¡¨æ—¶
	- ä¸€æ ·å—ï¼Ÿ


### åŸå§‹æŸ¥è¯¢

```
\c chinese_food_city

SELECT
	
FROM
	bill
NATURAL JOIN
	stall
;
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230929-1695980528425)

- å¦‚æœè¦å°† è€å®¶è‚‰é¥¼ 
	- ä¿®æ”¹ä¸º è€å®¶é¦…é¥¼
	- éœ€è¦ä¿®æ”¹3æ¡è®°å½•


### ä¿®æ”¹ä»£ç 

```
\c chinese_food_city

SELECT 
    bill.*,
	stall.shop,
	stall.shop_owner
FROM
	bill,
	stall
WHERE
    stall.dk_id = bill.dk_id
;
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230929-1695980571708)


- å¦‚æœè¦å°† è€å®¶è‚‰é¥¼ 
	- ä¿®æ”¹ä¸º è€å®¶é¦…é¥¼
	- éœ€è¦ä¿®æ”¹1æ¡è®°å½• å°±å¤Ÿäº†
- è¿™å°±æ˜¯ æ‰€è°“çš„
	- ä¸€æ”¹å…¨æ”¹

### ä¿®æ”¹

```
\c chinese_food_city

UPDATE
	stall
SET
	shop = 'è€å®¶é¦…é¥¼'
WHERE
	shop = 'è€å®¶è‚‰é¥¼'
;
```

- è¿è¡Œç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230929-1695980868163)

- è¿™æ · ä¿®æ”¹äº† 1æ¡æ¡£å£è®°å½•
	- æ‰€æœ‰çš„ äº¤æ˜“è®°å½• å°±éƒ½å·²ç»è¢«ä¿®æ”¹äº†å—ï¼Ÿ

### æŸ¥è¯¢äº¤æ˜“è®°å½•

```
\c chinese_food_city

SELECT
	*
FROM
	bill
NATURAL JOIN
	stall
;
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230929-1695981335227)

##  æ€»ç»“

- è¿™æ¬¡äº†è§£äº†ä¸€æ”¹å…¨æ”¹
	- åªè¦æ”¹äº†ä¸»è¡¨ä¸­çš„è®°å½•
	- åœ¨è‡ªç„¶è¿æ¥ä¸»è¡¨ã€ä»è¡¨çš„æŸ¥è¯¢ç»“æœå°±éƒ½è¢«ä¿®æ”¹äº†
	- 
- æ—¢ç„¶å¦‚æ­¤
	- ä¸ºä»€ä¹ˆåˆè¦æ‹†è¡¨å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ŸğŸ‘‹

