---
show: step
version: 1.0
enable_checker: true
---

#  max_æœ€å¤§å€¼_min_æœ€å°å€¼_èšåˆå‡½æ•°_aggregate_functions  

##  å›å¿†

- ä¸Šæ¬¡ å­¦ä¹ äº† ä¸¤ä¸ªèšåˆå‡½æ•°
	- max
	- min
- è¿™ä¸¤ä¸ªå‡½æ•°
	- å¯ä»¥å¯¹æ•´ä¸ªç»“æœé›† æ±‡æ€»
	- ä¹Ÿå¯ä»¥ æ ¹æ® ä¸åŒçš„ GROUP è¿›è¡Œæ±‡æ€»
		- æŒ‰ç…§å›½å®¶
		- æŒ‰ç…§åŸå¸‚
- å¯ä»¥ å¯¹äº æœ€å¤§å€¼ å’Œ æœ€å°å€¼ 
	- åŒæ—¶è¿›è¡Œæ±‡æ€»å—ï¼Ÿ

### ä¸Šæ¬¡ä»£ç 

```
\c sanguo

SELECT 
    city,
    min(value) AS min
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
    min DESC
LIMIT
	3
;
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230819-1692438043237)

- å¸Œæœ› å¯¹ 
	- æœ€å¤§å€¼
	- æœ€å°å€¼
	- åŒæ—¶æ±‡æ€»

### åŒæ—¶æ±‡æ€»

```
\c sanguo

SELECT 
    city,
	max(value) AS max,
    min(value) AS min
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
	max DESC,
    min DESC
LIMIT
    3
;
```

- åŒæ—¶æ±‡æ€»

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692783171608)

- é™¤äº†maxå’Œminä¹‹å¤– 
	- è¿˜æœ‰ä»€ä¹ˆ å¯ä»¥æ±‡æ€»çš„å‡½æ•°å—ï¼Ÿ

### æŸ¥è¯¢

- https://www.postgresql.org/docs/current/tutorial-agg.html

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692783330435)

- å°è¯•ä¿®æ”¹ä»£ç 

### avg å’Œ sum

```
\c sanguo

SELECT 
    city,
	sum(value) AS sum,
    avg(value) AS avg
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
	sum DESC
LIMIT
    3
;
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692783440827)

- å¦‚ä½•æ§åˆ¶ avg è¾“å‡ºç±»å‹çš„ æ˜¾ç¤ºç²¾åº¦å‘¢ï¼Ÿ

### round å‡½æ•°

- ä¿ç•™ä¸¤ä½å°æ•°

```
\c sanguo

SELECT 
    city,
	sum(value) AS sum,
    round(avg(value),2) AS avg
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
	sum DESC
LIMIT
    3
;
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692783652054)

- è¿™ä¸ªå¹³å‡å€¼ avg 
	- æ˜¯ä¸æ˜¯ ç”± sum / count å¾—åˆ°çš„å‘¢ï¼Ÿ

### æ„é€  sql

```
\c sanguo

SELECT 
    city,
	sum(value) AS sum,
	count(value) AS count,
    round(avg(value),2) AS avg,
	sum(value) / count(value) AS computed_avg
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
	sum DESC
LIMIT
    3
;
```

- æŸ¥è¯¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692784255680)

- åŸºæœ¬æ­£ç¡®
	- ä½†æ˜¯ æ•´æ•° é™¤ä»¥æ•´é™¤
	- é™¤æ³•è¿ç®— æ˜¯ åœ°æ¿é™¤
	- å¾—åˆ°çš„å•† è¿˜æ˜¯æ•´æ•°

### cast

```
\c sanguo

SELECT 
    city,
	sum(value) AS sum,
	count(value) AS count,
    round(avg(value),2) AS avg,
	sum(value)::float / count(value) AS computed_avg
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
	sum DESC
LIMIT
    3
;
```

- è®© è¢«é™¤æ•° æ‰®æ¼”ä¸€ä¸ª floatå‹
	- è¿™æ—¶å€™ é™¤æ³• ä» åœ°æ¿é™¤ å˜æˆäº† æµ®ç‚¹é™¤

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692784402725)

- æœ‰æ•ˆæ•°å­— æœ‰ç‚¹è¿‡å¤šäº†

### å››èˆäº”å…¥

```
\c sanguo

SELECT 
    city,
	sum(value) AS sum,
	count(value) AS count,
    round(avg(value),2) AS avg,
	round((sum(value)::real/count(value))::numeric, 2) AS computed_avg
FROM
    items
WHERE
    city IN ('é•¿æ²™','æ°¸å®‰','é•¿å®‰','æ±Ÿå·','æ´›é˜³')
GROUP BY
    city
ORDER BY
	sum DESC
LIMIT
    3
;
```

-  æ³¨æ„ ä½¿ç”¨ æ‹¬å· æ§åˆ¶ è¿ç®—æ¬¡åº

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692785024274)

- è¿˜èƒ½åšäº›ä»€ä¹ˆæ ·çš„æŸ¥è¯¢å—ï¼Ÿ

## æ€»ç»“ğŸ¤”

- è¿™æ¬¡ä½¿ç”¨äº† 
	- å¤šä¸ª æ±‡æ€»é¡¹
- æ±‡æ€»çš„å‡½æ•° æœ‰ 
	- count
	- max
	- min
	- sum
	- avg
- è¿˜å¯ä»¥ å¯¹äºæ±‡æ€»é¡¹ è¿›è¡Œ 
	- æ ¼å¼è½¬åŒ–
	- å››èˆäº”å…¥
- å¯ä»¥å¯¹ æ±‡æ€»çš„ ç»“æœè¿›è¡Œ ç­›é€‰å—ğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ŸğŸ‘‹ğŸ»
