---
show: step
version: 1.0
enable_checker: true
---

# 在psql中编辑并运行sql语句

## 回忆

- 上次我们编辑了sql文件
  - sql文件是纯文本文件
  - sql批量处理并执行sql命令
- 而且我们执行了sql文件
  - 在postgres中可以执行sql文件
  - `\i /tmp/test.sql`
- 但是编辑和执行分别在两个状态
  - shell和psql
  - 切来切去很麻烦
  - 能否在一个状态中就连编辑带执行
  - 一条龙全做了呢？🤔
- 下次再说 👋

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658383948877)

### 先查帮助

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390085992)

- 好像是可以的
- 我们试试

### 编辑sql文件

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390155550)

- 确实好像是可以的
- 但是有的时候还要设置好具体的编辑器之类的东西
- 我们选择比较熟悉的就好

### 保存问题

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390285892)

- 这其实设置了readonly也不能解决问题
- 另存是可以解决问题的

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390464093)

- 但是如果我就想编辑这个文件
- 应该怎么办呢？

### 所有者问题

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390504342)

- 我们可以通过设置所有者的方式
- 来解决这个问题
- 然后再回去
  - \e /tmp/test.sql

### 尝试写入

- :w
  - 确实是可以写入文件的
- :q
  - 退出vim
- \i /tmp/test.sql
  - 执行test.sql语句

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390828470)

- 出现了错误

### 纠错

- 错误原因是在连接着oeasydb数据库的时候
- 尝试着删除oeasydb
- 就像在当前文件夹中删除当前文件夹
- 人不能靠提着头发跳起来

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390916701)

- 先从oeasydb中退出来
- 再去尝试删除

### 尝试运行

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658391078970)

- 这次可以顺利成功了
- 这次都是在psql里面进行的
  - \e 进行编辑
  - \i 进行运行
- 我们先总结吧

### 总结

- 我们这次希望不在shell和psql中来回反复横跳
- 全都在psql中执行好一切命令
  - \e 进行编辑
  - \i 进行运行
- 这样就可以不用\q退回到shell了
- 还有更好用的工作流么？
- 我们下次再说

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658391401106)
