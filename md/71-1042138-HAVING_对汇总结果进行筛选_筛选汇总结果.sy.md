---
show: step
version: 1.0
enable_checker: true
---

#  max_æœ€å¤§å€¼_min_æœ€å°å€¼_èšåˆå‡½æ•°_aggregate_functions  

##  å›å¿†

- ä¸Šæ¬¡ä½¿ç”¨äº† å¤šä¸ª æ±‡æ€»é¡¹
- æ±‡æ€»çš„å‡½æ•° æœ‰ 
	- count
	- max
	- min
	- sum
	- avg
- å¯ä»¥å¯¹ æ±‡æ€»çš„ ç»“æœè¿›è¡Œ ç­›é€‰å—ğŸ¤”

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230823-1692785058558)

### å¯¹äº è‹±é›„çš„ å¹³å‡å€¼ æ±‡æ€»

- æ‰€æœ‰ è‹±é›„çš„ 
	- æ­¦åŠ›å¹³å‡å€¼

```
\c sanguo

SELECT 
    round(avg(fight),2) AS avg_fight
FROM
    heroes
;
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692873070798)

- å¯ä»¥æŒ‰ æ”¿æƒ åˆ†ç»„å—ï¼Ÿ
	- å¯¹æ­¦åŠ› æ±‚å¹³å‡å€¼

### åˆ†ç»„ GROUP BY

```
\c sanguo

SELECT 
	nation,
    round(avg(fight),2) AS avg_fight
FROM
    heroes
GROUP BY
	nation
;
```

- åˆ†ç»„æ±‡æ€»ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692873705364)

- å¯ä»¥å¯¹äºåˆ†ç»„ç»“æœ è¿›è¡Œæ’åºå—ï¼Ÿ

### æ’åº_ORDER_BY

```
\c sanguo

SELECT 
	nation,
	count(*),
    round(avg(fight),2) AS avg_fight
FROM
    heroes
GROUP BY
	nation
ORDER BY
	avg_fight DESC
;
```

- æ’åºç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692873945272)

- å¯ä»¥å¯¹ æœ€ç»ˆç»“æœ è¿›è¡Œç­›é€‰å—ï¼Ÿ

### å¯¹ç»Ÿè®¡ç»“æœç­›é€‰_HAVING

```
\c sanguo

SELECT 
	nation,
	count(*),
    round(avg(fight),2) AS avg_fight
FROM
    heroes
GROUP BY
	nation
HAVING
	avg(fight) >= 85
ORDER BY
	avg_fight DESC
;
```

- ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692874450958)

- è¿™é‡Œå‡ºç°äº†ä¸€ä¸ª æ–°çš„ å…³é”®å­— HAVING

### HAVING

- HAVING åé¢è·Ÿ æ¡ä»¶
	- https://www.postgresql.org/docs/current/sql-select.html

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692874301999)

- HAVING å’Œ WHERE å­å¥ éƒ½æ˜¯
	- é€šè¿‡ æ¡ä»¶åˆ¤æ–­ ç­›é€‰ 
- ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

### WHEREå­å¥

```
\c sanguo

SELECT 
	nation,
	count(*),
    round(avg(fight),2) AS avg_fight
FROM
    heroe
WHERE
	intelligence >= 60
GROUP BY
	nation
HAVING
	avg(fight) >= 85
ORDER BY
	avg_fight DESC
;
```

- æœç´¢ç»“æœ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692874588261)

- WHERE å­å¥
	- å¯¹äº æ¯ä¸€æ¡è®°å½• è¿›è¡Œç­›é€‰
	- å†³å®š å…¶æ˜¯å¦è¿›å…¥ç»Ÿè®¡
- HAVING å­å¥
	- å¯¹äº ç»Ÿè®¡çš„ç»“æœ è¿›è¡Œç­›é€‰
	- å†³å®š å…¶æ˜¯å¦å‡ºç°
- LIMIT å­å¥
	- ä¹Ÿæœ‰ç­›é€‰çš„ä½œç”¨
	- å’Œä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿ

### LIMIT

```
\c sanguo

SELECT 
	nation,
	count(*),
    round(avg(fight),2) AS avg_fight
FROM
    heroes
WHERE
	intelligence >= 60
GROUP BY
	nation
HAVING
	avg(fight) >= 85
ORDER BY
	avg_fight DESC
LIMIT 
    2
;
```

- LIMIT æ˜¯ å¯¹äºæœ€åç»“æœ
	- è¿›è¡Œæˆªå–æ“ä½œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692874792221)

- è¿˜å¯ä»¥è¿›è¡Œåˆ†é¡µå—ï¼Ÿ

### åˆ†é¡µ

```
\c sanguo

SELECT 
	nation,
	count(*),
    round(avg(fight),2) AS avg_fight
FROM
    heroes
WHERE
	intelligence >= 60
GROUP BY
	nation
HAVING
	avg(fight) >= 85
ORDER BY
	avg_fight DESC
LIMIT 
    2
OFFSET 
	2
;
```

- åˆ†é¡µ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692875015439)

## æ€»ç»“ğŸ¤”

- è¿™æ¬¡å­¦ä¹ äº†æ–°çš„å…³é”®å­—
	- HAVING
	- HAVING ç”¨æ¥å¯¹äºæ±‡æ€»ç»“æœè¿›è¡Œç­›é€‰
- æ±‡æ€» ä¸€å…±æœ‰äº”ä¸ªå‡½æ•°
	- count
	- sum
	- avg
	- max
	- min

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20230824-1692875172152)

- æ±‡æ€»å‡½æ•° è¢«ç§°ä½œ
	- aggregate functions
- aggregate è¯æº æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ
- ä¸‹æ¬¡å†è¯´ï¼ŸğŸ‘‹ğŸ»
