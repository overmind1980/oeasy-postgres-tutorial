---
show: step
version: 1.0
enable_checker: true
---

# 备份还原、导入导出总结

### 执行sql命令

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220417-1650201563773)

- 我们在psql中执行sql批处理命令
- \i ~/test.sql
- 然后编辑一个初始化数据库的sql文件
- 尝试执行
- 问题是总要在shell和psql两个里面来回切换

### 编辑sql文件

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658390155550)

- \i 可以执行sql文件
- \e 可以编辑sql文件
- 但这还不是最优的工作流

### 最优工作流

- 先进psql
- 然后用vi编辑sql文件
- 在vi中直接执行外部命令!psql
- psql 加上 `-f /home/shiyanlou/data`的参数

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658392161496)

- 系统有没有自动初始化数据库的办法呢？

### 转储dump

- dump的意思是倾倒
- 这里指的是把数据库的结构和内容
- 存储到sql的文件中

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220722-1658460302663)

- 可以把pg_dump转储输出得到的内容
- 输出重定向sql语句当中
- 有了这个就可以还原了么？

### 还原

- 上次是输出重定向
- 这次是输入重定向
- 把sql语句当做输入给到psql
- 一步步执行

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220721-1658409236126)

- 里面提到了一条命令COPY
- 是什么意思呢？

### 数据导出

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220723-1658535972533)

- 运行结果呢？

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220723-1658535985906)

- COPY TO
  - 导出了数据
- 那么数据可以导入么？

### 数据导入

- 上次数据导出是
  - COPY TO
- 这次数据导入是
  - COPY FROM

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20220723-1658539229034)

- 我们可以用更灵活的方式构建初始化文件
- 包括
  - 建表
  - 导入导出
- 各个文件各司其职
- 分工合作
- 我们最后总结一下

## 总结

- 我们这次找到了适合我们的工作流程
  - 进psql
  - \e 编辑sql文件
  - :!psql -f % 执行当前sql批处理命令
- 数据库的备份还原
  - pg_dump 备份
  - psql oeasydb < oeasydb.sql 还原
- 数据导入导出
  - COPY TO 是导出
  - COPY FROM 是导入
- 我们还没有建立起一个有意义的数据库
- 下次试试？👋🏻
